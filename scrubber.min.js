!function($){$.fn.scrubber=function(options,sprites,timings){sprites=sprites||{},timings=timings||{};var defaults={spriteURL:"img/sprite_178x129_54.jpg",thumbWidth:178,thumbHeight:129,numImages:54,duration:3456,offset:478},settings=$.extend({},defaults,options);return this.each(function(i){var thumbBox=$(this),thumb=thumbBox.find("img"),thumbId=thumb.attr("id"),hLink=thumbBox.parent(),contentId=$(this).attr("id").replace("t-",""),spriteImgSrc=$.isEmptyObject(sprites)?settings.spriteURL:sprites[i].url,duration=$.isEmptyObject(timings)?settings.duration:timings[i].duration,thumbOffset=$.isEmptyObject(timings)?settings.offset:timings[i].offset,startOffset=thumbOffset,loaderImgStr='<span class="sprite-loading-overlay" id="li-'+contentId+'"></span>',initialLink=hLink.attr("href"),loaderImg=null,timeBox={},timeBoxBody={},arrow={},timedot={},timeline={},initLoadTimeOut=null,scrubTimeOut=null;thumb.attr("class","i0");var durIntervals=Math.floor(duration/settings.numImages),timelineValue=Math.round(thumbOffset/durIntervals),prepScrubbing=function(){initLoadTimeOut=window.setTimeout(initScrubImage,500)},initScrubImage=function(){"i0"===thumb.attr("class")&&(thumb.attr("class","i1"),$("#li-"+contentId).length||(thumbBox.append(loaderImgStr),loaderImg=$("#li-"+contentId)),hideScrubElements(),loaderImg.show(),thumb.attr("src",spriteImgSrc))};thumb.on("load",function(e){"i1"===thumb.attr("class")&&(thumb.attr("class","i2"),$(loaderImg).hide(),thumb.css("top","-"+(0===timelineValue?0:timelineValue*settings.thumbHeight)+"px"),null!=initLoadTimeOut&&clearTimeout(initLoadTimeOut),thumbBox.unbind("mouseover",prepScrubbing),thumbBox.unbind("mouseover",initScrubElements),showScrubElements(),thumbBox.mousemove(function(e){showScrubElements(),scrubThumb(e)}))});var scrubThumb=function(e){clearTimeout(scrubTimeOut);var uiValue=Math.floor((e.pageX-thumb.offset().left)/(settings.thumbWidth/(settings.numImages-1)));uiValue<0&&(uiValue=0);var idx=uiValue,ypos=idx*settings.thumbHeight;thumb.css("top","-"+ypos+"px"),startOffset=durIntervals*uiValue,hLink.attr("href",initialLink+"/"+startOffset),timeBoxBody.text(formatScrubTime(durIntervals*uiValue));var timeboxPosition=Math.floor(e.pageX-thumb.offset().left-timeBox.width()/2),arrowPosition=Math.floor(timeboxPosition+timeBox.width()/2-2);timeboxPosition<-3&&(timeboxPosition=-3),arrowPosition<0&&(arrowPosition=0),arrowPosition>settings.thumbWidth-11&&(arrowPosition=settings.thumbWidth-11),timeBoxBody.text().length<=4&&uiValue>48||timeBoxBody.text().length>4&&uiValue>47?timeBox.css({left:"",right:"2px"}):timeBox.css({left:timeboxPosition+"px",right:""}),arrow.css({left:arrowPosition+"px",right:""}),timedot.css({left:arrowPosition+3+"px",right:""}),0===timeBox.filter(":hover").length&&0===arrow.filter(":hover").length&&(scrubTimeOut=window.setTimeout(hideTimePill,600))},formatScrubTime=function(secs){var hours=Math.floor(secs/3600);hours<1&&(hours="");var minutes=Math.floor(secs/60%60);hours>=1&&(minutes=minutes<10?":0"+minutes:":"+minutes);var seconds=secs%60;return seconds<10&&(seconds="0"+seconds),hours+minutes+":"+seconds},initScrubElements=function(){var scrubElStr='<span class="timebox" id="tb'+thumbId+'">                    <span class="timebox-body" id="tbb'+thumbId+'">'+duration+'</span>                    <span class="timebox-cap"></span>                    </span>                    <span class="arrow" id="a'+thumbId+'"></span>                    <span class="timedot" id="td'+thumbId+'"></span>                    <span class="timeline" id="tl'+thumbId+'"></span>';thumbBox.append(scrubElStr),timeBox=$("#tb"+thumbId),timeBoxBody=$("#tbb"+thumbId),arrow=$("#a"+thumbId),timedot=$("#td"+thumbId),timeline=$("#tl"+thumbId),thumbBox.addClass("init");var tbStartPos=-3,arrowStartPos=0;timeBoxBody.text(formatScrubTime(thumbOffset)),tbStartPos=Math.floor(3*timelineValue-timeBox.width()/2),arrowStartPos=Math.floor(tbStartPos+timeBox.width()/2-2),tbStartPos<-3&&(tbStartPos=-3),arrowStartPos<0&&(arrowStartPos=0),arrowStartPos>settings.thumbWidth-11&&(arrowStartPos=settings.thumbWidth-11),timeBoxBody.text().length<=4&&timelineValue>48||timeBoxBody.text().length>4&&timelineValue>47?(timeBox.css("right","2px"),arrow.css("right",Math.floor(timeBox.width()/2-5)+"px"),timedot.css("right",Math.floor(timeBox.width()/2-2)+"px")):(timeBox.css("left",tbStartPos+"px"),arrow.css("left",arrowStartPos+"px"),timedot.css("left",arrowStartPos+3+"px")),hLink.attr("href",initialLink+"/"+thumbOffset),"i0"===thumb.attr("class")&&showScrubElements()},showScrubElements=function(){timeBox.show(),arrow.show(),timedot.show(),timeline.show()},hideTimePill=function(){timeBox.hide(),arrow.hide()},hideScrubElements=function(){clearTimeout(initLoadTimeOut),timeline.length&&(timeBox.hide(),arrow.hide(),timedot.hide(),timeline.hide())};thumbBox.mouseover(function(){$(this).hasClass("init")?showScrubElements():initScrubElements(),prepScrubbing()}),thumbBox.mouseout(function(){hideScrubElements()})})}}(jQuery);